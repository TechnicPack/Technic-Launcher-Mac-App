on trim_line(this_text, trim_chars)
	set x to the length of the trim_chars
	repeat while this_text begins with the trim_chars
		try
			set this_text to characters (x + 1) thru -1 of this_text as string
		on error
			return ""
		end try
	end repeat
	return this_text
end trim_line
on run
	do shell script "mkdir -p ~/Library/Application\\ Support/techniclauncher/temp; touch ~/Library/Application\\ Support/techniclauncher/technic-launcher.jar; rm -rf ~/Library/Application\\ Support/techniclauncher/temp/technic-launcher.jar"
	try
		do shell script "curl http://mirror.technicpack.net/Technic/technic-launcher.jar >> ~/Library/Application\\ Support/techniclauncher/temp/technic-launcher.jar"
	on error
		display alert "Error: 'Could Not Connect to Technic Site' 
		Continuing in Offline Mode"
		try
			do shell script "java -jar ~/Library/Application\\ Support/techniclauncher/technic-launcher.jar"
		on error
			display alert "Error: 'Technic Launcher Not Installed'
			Terminating"
			return
		end try
		return
	end try
	set username to do shell script "whoami"
	set md5Current to do shell script "md5 ~/Library/Application\\ Support/techniclauncher/technic-launcher.jar"
	set md5Current to trim_line(md5Current, "MD5 (/Users/" & username & "/Library/Application Support/techniclauncher/technic-launcher.jar) = ")
	set md5Latest to do shell script "md5 ~/Library/Application\\ Support/techniclauncher/temp/technic-launcher.jar"
	set md5Latest to trim_line(md5Latest, "MD5 (/Users/" & username & "/Library/Application Support/techniclauncher/temp/technic-launcher.jar) = ")
	if md5Current is not md5Latest then
		set answer to button returned of (display dialog "A new launcher update as found! Update?" buttons {"Not Now", "Update"} default button 2)
		if answer is "Update" then
			do shell script "rm -rf ~/Library/Application\\ Support/techniclauncher/technic-launcher.jar; cp -r ~/Library/Application\\ Support/techniclauncher/temp/technic-launcher.jar ~/Library/Application\\ Support/techniclauncher/technic-launcher.jar"
			try
				do shell script "java -jar ~/Library/Application\\ Support/techniclauncher/technic-launcher.jar"
			on error
				display alert "Error: 'Corrupt Download'
				Terminating"
				return
			end try
		end if
		if answer is "Not Now" then
			try
				do shell script "java -jar ~/Library/Application\\ Support/techniclauncher/technic-launcher.jar"
			on error
				display alert "Error: 'Technic Launcher Not Installed'
				Terminating"
				return
			end try
		end if
	end if
	if md5Latest is md5Current then
		try
			do shell script "java -jar ~/Library/Application\\ Support/techniclauncher/technic-launcher.jar"
		on error
			display alert "Error: 'Corrupt Technic Launcher Install'
		Terminating"
			return
		end try
	end if
	do shell script "rm -rf ~/Library/Application\\ Support/techniclauncher/temp/technic-launcher.jar"
end run
